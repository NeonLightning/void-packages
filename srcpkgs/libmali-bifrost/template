# Template file for 'libmali-bifrost'
pkgname=libmali-bifrost
version=1.0.0
revision=2
_gitrev=7fca6310eceb5b85062259ed8f4a5c1cf44fe773
wrksrc="libmali-${_gitrev}"
short_desc="mali bifrost"
maintainer="valadaa48 <valadaa48@gmx.com>"
license="GPL-3.0-or-later"
homepage="https://github.com/rockchip-linux/libmali"
distfiles="https://github.com/rockchip-linux/libmali/archive/${_gitrev}.tar.gz"
checksum=49fdd86cc046e109ecb610fc2bde6bdbe2c63cd5e2aaba6bcdc4f00add884ea3
makedepends="libdrm"

do_install() {
    local _lib _dir
    _lib="libmali-bifrost-g31-rxp0-gbm.so"

    case "$XBPS_TARGET_MACHINE" in
        aarch64*) _dir="aarch64-linux-gnu";;
        arm*) _dir="arm-linux-gnueabihf";;
    esac

    vinstall lib/${_dir}/${_lib} 755 usr/lib/mali

    cd ${DESTDIR}/usr/lib/mali
    ln -sf ${_lib} libEGL.so
    ln -sf ${_lib} libEGL.so.1
    ln -sf ${_lib} libEGL.so.1.0.0
    ln -sf ${_lib} libEGL.so.1.1.0
    ln -sf ${_lib} libGLESv1_CM.so
    ln -sf ${_lib} libGLESv1_CM.so.1
    ln -sf ${_lib} libGLESv1_CM.so.1.1.0
    ln -sf ${_lib} libGLESv2.so
    ln -sf ${_lib} libGLESv2.so.2
    ln -sf ${_lib} libGLESv2.so.2.0.0
    ln -sf ${_lib} libgbm.so.1
    ln -sf ${_lib} libgbm.so
    ln -sf ${_lib} libMali.so
    ln -sf ${_lib} libmali.so

    vinstall ${FILESDIR}/50-mali.rules 644 usr/lib/udev/rules.d
    vinstall ${FILESDIR}/libmali-bifrost.conf 644 etc/ld.so.conf.d
}

libmali-bifrost-devel_package() {
	depends="${sourcepkg}>=${version}_${revision}"
	short_desc+=" - development files"
	pkg_install() {
	    vmkdir usr
	    vcopy include usr/include
	}
}

